<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Horoscope Matching Tool ‚Äì Part 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0c1b1b;
  color:#f6e7b2;
  font-family:Arial,sans-serif;
  padding:20px;
}
h1{
  text-align:center;
  color:#facc15;
}
.panel{
  border:2px solid #c9a227;
  padding:14px;
  margin-bottom:18px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #c9a227;
  padding:6px;
  text-align:center;
}
th{background:#123c3c}
select,input{
  background:#102a2a;
  color:#fef3c7;
  border:1px solid #c9a227;
  padding:6px;
  font-weight:700;
}
.controls label{
  margin-right:14px;
}





/* ===== ACTION BUTTONS ===== */

.action-bar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  flex-wrap:wrap;
}

.action-left{
  display:flex;
  align-items:center;
  gap:14px;
  flex-wrap:wrap;
}

.action-right{
  display:flex;
  align-items:center;
  gap:10px;
}

.action-btn{
  padding:6px 16px;
  font-weight:900;
  border-radius:6px;
  border:2px solid #fde68a;
  background:linear-gradient(145deg,#facc15,#c9a227,#facc15);
  color:#1f2933;
  cursor:pointer;
  box-shadow:
    inset 0 0 6px rgba(255,255,255,0.4),
    0 0 6px rgba(250,204,21,0.6);
}

.action-btn:hover{
  filter:brightness(1.1);
}

.action-btn.clear{
  background:linear-gradient(145deg,#fb923c,#f97316,#fb923c);
  border-color:#fed7aa;
}





/* ===== GAP ROW (PRIORITY SEPARATOR) ===== */
.gap-row td{
  height:15px;          /* half of normal row */
  border:none !important;
  padding:0 !important;
  background:transparent;
}












/* ===== TABLE 6 : 36 GUNA MATRIX ===== */

#guna36Table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

#guna36Table th,
#guna36Table td{
  border:1px solid #c9a227;
  padding:6px;
  text-align:center;
}

#guna36Table thead th{
  background:#123c3c;
  color:#fde68a;
  font-weight:900;
}

#guna36Table td.total{
  font-weight:900;
  font-size:14px;
}

/* Lagna highlight */
#guna36Table tr.guna-lagna{
  background:#102a2a;
  border:2px solid #facc15;
}

/* Score coloring (will be applied by JS later) */
.guna-good{ color:#16a34a; font-weight:900; }
.guna-avg{ color:#f59e0b; font-weight:900; }
.guna-bad{ color:#dc2626; font-weight:900; }













</style>





</head>

<body>

<h1>Groom & Bride Horoscope Matching</h1>




<div class="panel">
  <div class="action-bar">

    <!-- LEFT SIDE CONTROLS -->
    <div class="action-left">
      <label>
        <input type="radio" name="sys" value="vedic">
        Vedic
      </label>

      <label>
        <input type="radio" name="sys" value="kp" checked>
        KP
      </label>

      <label>
        <input type="checkbox" id="ignorePadas">
        Ignore Padas
      </label>

      <label>
        <input type="checkbox" id="rkLink" checked>
        Rahu + Ketu Link
      </label>
	  
	  
	  <label>
	  <input type="checkbox" id="sign2sign">
	  Sign to Sign
	</label>

	  
    </div>

    <!-- RIGHT SIDE ACTIONS -->
    <div class="action-right">
      <button class="action-btn" onclick="saveChart()">Save</button>
	  <button class="action-btn" onclick="loadMaleSwiss()">Load Male</button>
	<button class="action-btn" onclick="loadFemaleSwiss()">Load Female</button>

      <button class="action-btn clear" onclick="clearAll()">Clear</button>
    </div>

  </div>
</div>





<input type="file" id="fileInput" accept=".json" style="display:none"/>
<input type="file" id="maleSwissInput" accept=".json" style="display:none"/>
<input type="file" id="femaleSwissInput" accept=".json" style="display:none"/>

















<!-- ================= TABLE 1 : INPUT ================= -->

<div class="panel">
<h2>Table 1 ‚Äì Input Details</h2>



<div style="margin-bottom:8px;font-weight:900">
  <label style="margin-right:16px">
    <input type="checkbox" id="hideCusps" checked>
    Hide Cusps
  </label>

  <label>
    <input type="checkbox" id="hideCuspProgs" checked>
    Hide Cusp Progs
  </label>
  
  <label>
  <input type="checkbox" id="hidePlanetProgsT1" checked>
  Hide Planet Progs
</label>

  
  
</div>



<table id="inputTable">
<thead>
<tr>
  <th>Entity</th>
  <th>Boy</th>
  <th>Girl</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
/* ===================== MASTER DATA ===================== */

const nak = [
"Ashwini","Bharani","Krittika","Rohini","Mrigashira","Ardra","Punarvasu","Pushya","Ashlesha",
"Magha","Purva Phalguni","Uttara Phalguni","Hasta","Chitra","Swati","Vishakha","Anuradha","Jyeshtha",
"Moola","Purva Ashadha","Uttara Ashadha","Shravana","Dhanishta","Shatabhisha",
"Purva Bhadrapada","Uttara Bhadrapada","Revati"
];

const nakLords = [
"Ketu","Venus","Surya","Chandra","Mangala","Rahu","Jupiter","Saturn","Budha",
"Ketu","Venus","Surya","Chandra","Mangala","Rahu","Jupiter","Saturn","Budha",
"Ketu","Venus","Surya","Chandra","Mangala","Rahu","Jupiter","Saturn","Budha"
];

const rasiNames = [
"‡≤Æ‡≥á‡≤∑","‡≤µ‡≥É‡≤∑‡≤≠","‡≤Æ‡≤ø‡≤•‡≥Å‡≤®","‡≤ï‡≤ü‡≤ï","‡≤∏‡≤ø‡≤Ç‡≤π","‡≤ï‡≤®‡≥ç‡≤Ø‡≤æ",
"‡≤§‡≥Å‡≤≤‡≤æ","‡≤µ‡≥É‡≤∂‡≥ç‡≤ö‡≤ø‡≤ï","‡≤ß‡≤®‡≤∏‡≥ç‡≤∏‡≥Å","‡≤Æ‡≤ï‡≤∞","‡≤ï‡≥Å‡≤Ç‡≤≠","‡≤Æ‡≥Ä‡≤®‡≤æ"
];

/* ===================== PADAS (108) ===================== */

const padas=[];
let pc=0;

for(let i=0;i<27;i++){
  for(let p=1;p<=4;p++){
    const rasiIndex=Math.floor(pc/9);
    padas.push({
      index:pc,
      label:`[${pc+1}]. ${rasiNames[rasiIndex]} - ${rasiIndex+1} - ${nakLords[i]} - ${nak[i]} - ${p}`
    });
    pc++;
  }
}

const TOTAL_PADAS = padas.length;

/* ===================== DROPDOWN BUILDER ===================== */

function buildSelect(){
  return `
    <select>
      <option value="">-- Select --</option>
      ${padas.map(p=>`<option value="${p.index}">${p.label}</option>`).join("")}
    </select>
  `;
}

/* ===================== TABLE 1 BUILD ===================== */



function updateTable1HideOnly(){

  const hideCusps =
    document.getElementById("hideCusps")?.checked;

  const hideCuspProgs =
    document.getElementById("hideCuspProgs")?.checked;

  const hidePlanetProgs =
    document.getElementById("hidePlanetProgsT1")?.checked;

  [...tbody.querySelectorAll("tr[data-entity]")].forEach(tr=>{
    const e = tr.dataset.entity;
    tr.style.display = "";

    // Natal cusps
    if(hideCusps && e.startsWith("Cusp ") && !e.includes("Progs")){
      tr.style.display = "none";
    }

    // Cusp progressions
    if(hideCuspProgs && /^Cusp\s*\d+\s+Progs$/.test(e)){
      tr.style.display = "none";
    }

    // Planet progressions ONLY
    if(
      hidePlanetProgs &&
      e.endsWith("Progs") &&
      !e.startsWith("Lagn") &&
      !e.startsWith("Chandra") &&
      !e.startsWith("Cusp")
    ){
      tr.style.display = "none";
    }
  });
}









const orderedEntities = [
  "Lagna",
  "Chandra",
    "_gap_",
  "Venus",
  "Mangala",
  "Guru",
  "_gap_",
  "Budha",
  "Shani",
  "_gap_",
  "Surya",
  "Rahu",
  "Ketu",
  "_gap_",
  "_gap_",

  /* ===== CORE PROGRESSIONS ===== */
  "Lagn Progs",
  "Chandra Progs",
  "ALP Progs",

 "_gap_",
  "Venus Progs",
  "Mangala Progs",
  "Guru Progs",
  
  "_gap_",
  
  "Budha Progs",
  "Shani Progs",
  "_gap_",
  
   "Surya Progs",
  "Rahu Progs",
  "Ketu Progs",

  "_gap_",

	 "Cusp 1",
	 "Cusp 2",
	"Cusp 3",
	"Cusp 4",
	"Cusp 5",
	"Cusp 6",
	"Cusp 7",
	"Cusp 8",
	"Cusp 9",
	"Cusp 10",
	"Cusp 11",
	"Cusp 12",


  "_gap_",

	"Cusp 1 Progs",
	"Cusp 2 Progs",
	"Cusp 3 Progs",
	"Cusp 4 Progs",
	"Cusp 5 Progs",
	"Cusp 6 Progs",
	"Cusp 7 Progs",
	"Cusp 8 Progs",
	"Cusp 9 Progs",
	"Cusp 10 Progs",
	"Cusp 11 Progs",
	"Cusp 12 Progs",


 
];


// entities WITHOUT gaps (used for calculations)
const entities = orderedEntities.filter(e => e !== "_gap_");






const tbody = document.querySelector("#inputTable tbody");

orderedEntities.forEach(e=>{
  if(e === "_gap_"){
    tbody.insertAdjacentHTML("beforeend",`
      <tr class="gap-row">
        <td colspan="3"></td>
      </tr>
    `);
    return;
  }

  tbody.insertAdjacentHTML("beforeend",`
    <tr data-entity="${e}">
      <td><b>${e}</b></td>
      <td>${buildSelect()}</td>
      <td>${buildSelect()}</td>
    </tr>
  `);
});




/* ===================== RAHU‚ÄìKETU LINK ===================== */

tbody.addEventListener("change",e=>{
  if(IS_SWISS_LOADING) return;
  if(!document.getElementById("rkLink").checked) return;
  if(e.target.tagName!=="SELECT") return;

  const tr=e.target.closest("tr");
  const entity=tr.dataset.entity;
  if(entity!=="Rahu" && entity!=="Ketu") return;
if(tr.dataset.entity==="ALP Progs") return;

  const val=e.target.value;
  if(val==="") return;

  const opposite=(Number(val)+54)%TOTAL_PADAS;
  const otherEntity=entity==="Rahu"?"Ketu":"Rahu";

  const otherRow=[...tbody.children].find(r=>r.dataset.entity===otherEntity);
	const colIndex = e.target.closest("td").cellIndex;

	const otherSelect =
	  otherRow.children[colIndex].querySelector("select");


  otherSelect.value=opposite;
});
</script>












<script>
/* ===================== SAVE ===================== */

function saveChart(){
  const data = {
    system: document.querySelector('input[name="sys"]:checked').value,
    ignorePadas: document.getElementById("ignorePadas").checked,
    rkLink: document.getElementById("rkLink").checked,
    entries: {}
  };

  [...tbody.querySelectorAll('tr[data-entity]')].forEach(tr=>{
    const ent = tr.dataset.entity;
    const boy = tr.children[1].querySelector("select").value;
    const girl = tr.children[2].querySelector("select").value;
    data.entries[ent] = { boy, girl };
  });

  const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "HoroscopeMatching.json";
  a.click();
}

/* ===================== LOAD ===================== */

function loadChart(){
  const inp=document.getElementById("fileInput");
  inp.value="";
  inp.click();

  inp.onchange=e=>{
    const file=e.target.files[0];
    if(!file) return;

    const reader=new FileReader();
    reader.onload=()=>{
      const d=JSON.parse(reader.result);

      document.querySelector(`input[name="sys"][value="${d.system}"]`).checked=true;
      document.getElementById("ignorePadas").checked=d.ignorePadas;
      document.getElementById("rkLink").checked=d.rkLink;

      [...tbody.querySelectorAll('tr[data-entity]')].forEach(tr=>{
        const ent=tr.dataset.entity;
        if(d.entries[ent]){
          tr.children[1].querySelector("select").value=d.entries[ent].boy;
          tr.children[2].querySelector("select").value=d.entries[ent].girl;
        }
      });

      setTimeout(()=>{
        recalcTable2();
        recalcTable3();
        recalcTable4();
        recalcTable5();
        recalcTable6();   // üî• NOW IT RUNS
      },0);
    };
    reader.readAsText(file);
  };
}

/* ===================== CLEAR ===================== */

function clearAll(){
 

  document.querySelectorAll("select").forEach(s=>s.value="");
  document.getElementById("ignorePadas").checked=false;
  document.getElementById("rkLink").checked=true;

  document.querySelectorAll(
    "#resultTable td,#lagnaPlanetTable td,#tatvaTable td,#taraTable td,#guna36Table td:not(:first-child)"
  ).forEach(td=>td.innerText="");
}
</script>
























<!-- ================= TABLE 2 : DIRECT MATCHING ================= -->

<div class="panel">
<h2>Table 2 ‚Äì Lagna ‚Üî Lagna & Planet ‚Üî Planet</h2>



<div style="margin-bottom:10px;font-weight:900">
  <label style="margin-right:16px">
    <input type="checkbox" id="ignorePlanetProgs" checked>
    Ignore Planet Progs
  </label>

  <label style="margin-right:16px">
    <input type="checkbox" id="ignoreCuspProgs" checked>
    Ignore Cusp Progs
  </label>

  <label>
    <input type="checkbox" id="ignoreCusps" checked>
    Ignore Cusps
  </label>
</div>





<table id="resultTable">
<thead>
<tr>
	<th>Entity</th>
	<th>Boy ‚Üí Girl</th>
	<th>Eq</th>
	<th>Result</th>
	<th>Girl ‚Üí Boy</th>
	<th>Eq</th>
	<th>Result</th>


</tr>
</thead>
<tbody></tbody>

</table>

<table style="margin-top:6px;width:100%">
  <tr>
    <td style="font-weight:900">Boy ‚Üí Girl</td>
    <td id="t2bg_pos" style="color:#16a34a;font-weight:900"></td>
    <td id="t2bg_avg" style="color:#f59e0b;font-weight:900"></td>
    <td id="t2bg_neg" style="color:#dc2626;font-weight:900"></td>
  </tr>
  <tr>
    <td style="font-weight:900">Girl ‚Üí Boy</td>
    <td id="t2gb_pos" style="color:#16a34a;font-weight:900"></td>
    <td id="t2gb_avg" style="color:#f59e0b;font-weight:900"></td>
    <td id="t2gb_neg" style="color:#dc2626;font-weight:900"></td>
  </tr>
</table>

</div>





<script>
/* ===================== HOUSE + EQUIVALENCE ENGINE ===================== */

function getSystem(){
  return document.querySelector('input[name="sys"]:checked').value;
}



function getDistance(from,to){
  const sign2sign = document.getElementById("sign2sign")?.checked;
  const ignorePadas = document.getElementById("ignorePadas").checked;
  const sys = getSystem();

  // SIGN TO SIGN MODE (highest priority)
  if(sign2sign){
    const rf = Math.floor(from / 9); // 0‚Äì11
    const rt = Math.floor(to / 9);   // 0‚Äì11
    return ((rt - rf + 12) % 12) * 9;
  }

  // IGNORE PADAS (nakshatra based)
  if(ignorePadas){
    const nf = Math.floor(from / 4);
    const nt = Math.floor(to / 4);
    return ((nt - nf + 27) % 27) * 4;
  }

  // NORMAL MODE
  if(sys==="vedic"){
    return (to - from + 108 + 4) % 108;
  }

  return (to - from + 108) % 108;
}






function houseFromDistance(d){
  return Math.floor(d/9)%12+1;
}

/* ===== YOUR GENERALIZED EQUIVALENCE RULE ===== */

function equivalentHouseTable2(h){
  if(h===1) return "1-1";
  if(h===2||h===12) return "2-12";
  if(h===3||h===11) return "3-11";
  if(h===4||h===10) return "4-10";
  if(h===5||h===9) return "5-9";
  if(h===6||h===8) return "6-8";
  if(h===7) return "7-7";
  return "";
}




function verdict(eq){

  // GOOD
  if(eq === "3-11" || eq === "5-9"){
    return { text:"Good", color:"#16a34a" };
  }

  // AVERAGE
  if(
    eq === "1-1" ||
    eq === "4-10" ||
    eq === "7-7"      // üî• MISSING CASE (FIX)
  ){
    return { text:"Average", color:"#f59e0b" };
  }

  // BAD
  if(eq === "2-12" || eq === "6-8"){
    return { text:"Bad", color:"#dc2626" };
  }

  return { text:"", color:"" };
}






/* ===================== BUILD TABLE 2 ===================== */

const resultBody=document.querySelector("#resultTable tbody");

orderedEntities.forEach(e=>{
  if(e === "_gap_"){
    resultBody.insertAdjacentHTML("beforeend",`
      <tr class="gap-row">
        <td colspan="4"></td>
      </tr>
    `);
    return;
  }

  resultBody.insertAdjacentHTML("beforeend",`
    <tr data-entity="${e}">
  <td><b>${e}</b></td>

  <td class="houseBG"></td>
  <td class="eqBG"></td>
  <td class="resBG"></td>

  <td class="houseGB"></td>
  <td class="eqGB"></td>
  <td class="resGB"></td>
	</tr>


  `);
});

/* ===================== Define entity categories for Table 2 filtering ===================== */




function isPlanetProg(entity){
  return entity.endsWith("Progs") &&
         !entity.startsWith("Lagn") &&
         !entity.startsWith("Chandra");
}

function isCusp(entity){
  return entity.startsWith("Cusp ") && !entity.includes("Progs");
}

function isCuspProg(entity){
  return /^Cusp\s*\d+\s+Progs$/.test(entity);
}








/* ===================== CORE RECALC ===================== */








function recalcTable2(){

  let bg_pos=0, bg_avg=0, bg_neg=0;
  let gb_pos=0, gb_avg=0, gb_neg=0;

  const ignorePlanetProgs = document.getElementById("ignorePlanetProgs").checked;
  const ignoreCuspProgs   = document.getElementById("ignoreCuspProgs").checked;
  const ignoreCusps       = document.getElementById("ignoreCusps").checked;

  entities.forEach(e=>{

    const inRow  = [...tbody.children].find(r=>r.dataset?.entity===e);
    const outRow = [...resultBody.children].find(r =>
  r.dataset?.entity?.replace(/\s+/g,"") === e.replace(/\s+/g,"")
);

    if(!inRow || !outRow) return;






/* ===== RESET VISIBILITY FIRST (CRITICAL) ===== */
outRow.style.display = "";

/* ===== APPLY IGNORE RULES ===== */
if (
  (ignorePlanetProgs && isPlanetProg(e)) ||
  (ignoreCuspProgs   && isCuspProg(e))   ||
  (ignoreCusps       && isCusp(e))
){
  outRow.style.display = "none";
  return; // skip calc for this run ONLY
}







    const b = inRow.children[1].querySelector("select").value;
    const g = inRow.children[2].querySelector("select").value;

    // üî• Do NOT early-return for Cusp Progs
	if(b==="" || g===""){
	  if (!isCuspProg(e)) {
		outRow.querySelectorAll("td").forEach((td,i)=>{
		  if(i>0) td.innerText="";
		});
		return;
	  }
	}


    /* ========= BOY ‚Üí GIRL ========= */
    const dBG = getDistance(Number(b), Number(g));
    const hBG = houseFromDistance(dBG);
    const eqBG = equivalentHouseTable2(hBG);
    const vBG  = verdict(eqBG);

    outRow.querySelector(".houseBG").innerText = hBG;
    outRow.querySelector(".eqBG").innerText    = eqBG;
    outRow.querySelector(".resBG").innerText   = vBG.text;
    outRow.querySelector(".resBG").style.color = vBG.color;

    /* ========= GIRL ‚Üí BOY ========= */
    const dGB = getDistance(Number(g), Number(b));
    const hGB = houseFromDistance(dGB);
    const eqGB = equivalentHouseTable2(hGB);
    const vGB  = verdict(eqGB);

    outRow.querySelector(".houseGB").innerText = hGB;
    outRow.querySelector(".eqGB").innerText    = eqGB;
    outRow.querySelector(".resGB").innerText   = vGB.text;
    outRow.querySelector(".resGB").style.color = vGB.color;

    /* ========= COUNT (VISIBLE ROWS ONLY) ========= */
    if (outRow.style.display !== "none") {
      if (vBG.text === "Good")     bg_pos++;
      if (vBG.text === "Average")  bg_avg++;
      if (vBG.text === "Bad")      bg_neg++;

      if (vGB.text === "Good")     gb_pos++;
      if (vGB.text === "Average")  gb_avg++;
      if (vGB.text === "Bad")      gb_neg++;
    }
  });

  /* ========= UPDATE TOTALS (ONCE) ========= */
  document.getElementById("t2bg_pos").innerText = `Positive : ${bg_pos}`;
  document.getElementById("t2bg_avg").innerText = `Average : ${bg_avg}`;
  document.getElementById("t2bg_neg").innerText = `Negative : ${bg_neg}`;

  document.getElementById("t2gb_pos").innerText = `Positive : ${gb_pos}`;
  document.getElementById("t2gb_avg").innerText = `Average : ${gb_avg}`;
  document.getElementById("t2gb_neg").innerText = `Negative : ${gb_neg}`;
}



["ignorePlanetProgs","ignoreCuspProgs","ignoreCusps"].forEach(id=>{
  document.getElementById(id).addEventListener("change",()=>{
    updateTable1HideOnly();   // üî• UI ONLY
    recalcTable2();
  });
});


["hideCusps","hideCuspProgs"].forEach(id=>{
  document.getElementById(id).addEventListener("change",()=>{
    updateTable1HideOnly();
  });
});

["hidePlanetProgsT1"].forEach(id=>{
  document.getElementById(id).addEventListener("change",()=>{
    updateTable1HideOnly();
  });
});






</script>











<!-- ================= TABLE 3 : LAGNA ‚Üí PLANET ================= -->

<div class="panel">
<h2>Table 3 ‚Äì Lagna ‚Üí Planet Analysis</h2>
<table id="lagnaPlanetTable">
<thead>
<tr>
  <th>Planet</th>
  <th>Boy (From Lagna)</th>
  <th>Girl (From Lagna)</th>
  <th>Equivalent</th>
  <th>Result</th>
</tr>
</thead>
<tbody></tbody>

</table>

<table style="margin-top:6px;width:100%">
  <tr>
    <td style="text-align:left;font-weight:900">Total</td>
    <td id="t3pos" style="color:#16a34a;font-weight:900"></td>
    <td id="t3neg" style="color:#dc2626;font-weight:900"></td>
    <td></td>
    <td></td>
  </tr>
</table>

</div>







<script>




// ===== TABLE 3 DISPLAY ORDER (NO LAGNA / PROGS) =====
const table3Order = [
  "Chandra",
  "Venus",
  "Mangala",
  "Guru",
  "_gap_",
  "Budha",
  "Shani",
  "_gap_",
  "Surya",
  "Rahu",
  "Ketu"
];

// Used ONLY for calculations (no gaps)
const planetsOnly = table3Order.filter(p => p !== "_gap_");

const lagnaPlanetBody = document.querySelector("#lagnaPlanetTable tbody");




table3Order.forEach(p=>{
  // GAP ROW (VISUAL SEPARATOR)
  if(p === "_gap_"){
    lagnaPlanetBody.insertAdjacentHTML("beforeend",`
      <tr class="gap-row">
        <td colspan="7"></td>
      </tr>
    `);
    return;
  }

  // NORMAL PLANET ROW
  lagnaPlanetBody.insertAdjacentHTML("beforeend",`
    <tr data-planet="${p}">
      <td><b>${p}</b></td>
      <td class="boy"></td>
      <td class="girl"></td>
      <td class="eq"></td>
      <td class="res"></td>
    </tr>
  `);
});


/* ===================== TABLE 3 CALC ===================== */




function recalcTable3(){
  let pos = 0, avg = 0, neg = 0;

  const lagnaRow = [...tbody.children].find(r=>r.dataset.entity==="Lagna");
  if(!lagnaRow) return;

  const boyLagna = lagnaRow.children[1].querySelector("select").value;
  const girlLagna = lagnaRow.children[2].querySelector("select").value;

  if(boyLagna==="" || girlLagna===""){
  lagnaPlanetBody.querySelectorAll("tr").forEach(tr=>{
    tr.querySelector(".boy").innerText="";
    tr.querySelector(".girl").innerText="";
    tr.querySelector(".eq").innerText="";
    tr.querySelector(".res").innerText="";
    tr.querySelector(".res").style.color="";
  });
  return;
}


  planetsOnly.forEach(p=>{
    const inRow = [...tbody.children].find(r=>r.dataset.entity===p);
    const outRow = [...lagnaPlanetBody.children].find(r=>r.dataset.planet===p);

    const boyP = inRow.children[1].querySelector("select").value;
    const girlP = inRow.children[2].querySelector("select").value;

    if(boyP==="" || girlP===""){
      outRow.querySelector(".boy").innerText="";
      outRow.querySelector(".girl").innerText="";
      outRow.querySelector(".eq").innerText="";
      outRow.querySelector(".res").innerText="";
      return;
    }

    const dBoy = getDistance(Number(boyLagna), Number(boyP));
    const dGirl = getDistance(Number(girlLagna), Number(girlP));

    const hBoy = houseFromDistance(dBoy);
    const hGirl = houseFromDistance(dGirl);

    const eq = equivalentHouseTable3(hBoy,hGirl);
    const v  = verdict(eq);

   if(v.text==="Good") pos++;
	if(v.text==="Average") avg++;
	if(v.text==="Bad") neg++;


    outRow.querySelector(".boy").innerText = hBoy;
    outRow.querySelector(".girl").innerText = hGirl;
    outRow.querySelector(".eq").innerText = eq;
    outRow.querySelector(".res").innerText = v.text;
    outRow.querySelector(".res").style.color = v.color;
  });




    document.getElementById("t3pos").innerText = `Positive : ${pos}`;
	document.getElementById("t3neg").innerText = `Negative : ${neg}`;

	if(!document.getElementById("t3avg")){
	  document.getElementById("t3pos").insertAdjacentHTML(
		"afterend",
		`<td id="t3avg" style="color:#f59e0b;font-weight:900"></td>`
	  );
	}

	document.getElementById("t3avg").innerText = `Average : ${avg}`;

}






function equivalentHouseTable3(a,b){

  /* ===== EXACT SAME HOUSE ===== */
  if(a === b) return "1-1";

  /* ===== 1‚Äì7 OR 7‚Äì1 SPECIAL CASE ===== */
  if(
    (a === 1 && b === 7) ||
    (a === 7 && b === 1)
  ){
    return "7-7";
  }

  /* ===== INCLUSIVE DISTANCE COUNTING ===== */
  let d1 = b >= a ? (b - a + 1) : (12 - a + b + 1);
  let d2 = a >= b ? (a - b + 1) : (12 - b + a + 1);

  const x = Math.min(d1, d2);
  const y = Math.max(d1, d2);

  if(x===1 && y===13) return "1-1";
  if(x===2 && y===12) return "2-12";
  if(x===3 && y===11) return "3-11";
  if(x===4 && y===10) return "4-10";
  if(x===5 && y===9)  return "5-9";
  if(x===6 && y===8)  return "6-8";
  if(x===7 && y===7)  return "7-7";

  return "";
}









</script>









<!-- ================= TABLE 4 : TATVA MATCHING ================= -->

<div class="panel">
<h2>Table 4 ‚Äì Tatva Matching</h2>



<table id="tatvaTable">
<thead>
<tr>
  <th>Entity</th>
  <th>Boy Tatva</th>
  <th>Girl Tatva</th>
  <th>Result</th>
</tr>
</thead>
<tbody></tbody>
</table>

<table style="margin-top:6px;width:100%">
  <tr>
    <td style="text-align:left;font-weight:900">Total</td>
    <td id="t4pos" style="color:#16a34a;font-weight:900"></td>
    <td id="t4avg" style="color:#f59e0b;font-weight:900"></td>
    <td id="t4neg" style="color:#dc2626;font-weight:900"></td>
  </tr>
</table>

</div>










<script>
/* ===================== TATVA DATA ===================== */

const tatvaMap = {
  0:"Fire",   // Aries
  1:"Earth", // Taurus
  2:"Air",   // Gemini
  3:"Water", // Cancer
  4:"Fire",  // Leo
  5:"Earth", // Virgo
  6:"Air",   // Libra
  7:"Water", // Scorpio
  8:"Fire",  // Sagittarius
  9:"Earth", // Capricorn
  10:"Air",  // Aquarius
  11:"Water" // Pisces
};

/* ===================== TATVA TABLE BUILD ===================== */

const tatvaBody = document.querySelector("#tatvaTable tbody");

orderedEntities.forEach(e=>{
  if(e === "_gap_"){
    tatvaBody.insertAdjacentHTML("beforeend",`
      <tr class="gap-row">
        <td colspan="4"></td>
      </tr>
    `);
    return;
  }

  tatvaBody.insertAdjacentHTML("beforeend",`
    <tr data-entity="${e}">
      <td><b>${e}</b></td>
      <td class="bt"></td>
      <td class="gt"></td>
      <td class="res"></td>
    </tr>
  `);
});

/* ===================== TATVA LOGIC ===================== */






function tatvaVerdict(b,g){

  // SAME ELEMENT ‚Üí AVERAGE
  if(b === g){
    return { text:"Average", color:"#f59e0b" };
  }

  // BEST PAIRS ‚Üí GOOD
  if(
    (b==="Fire" && g==="Air") ||
    (b==="Air" && g==="Fire") ||
    (b==="Earth" && g==="Water") ||
    (b==="Water" && g==="Earth")
  ){
    return { text:"Good", color:"#16a34a" };
  }

  // WORST PAIRS ‚Üí BAD
  if(
    (b==="Fire" && g==="Water") ||
    (b==="Water" && g==="Fire") ||
    (b==="Air" && g==="Earth") ||
    (b==="Earth" && g==="Air")
  ){
    return { text:"Bad", color:"#dc2626" };
  }

  // FALLBACK (SAFETY)
  return { text:"Average", color:"#f59e0b" };
}



/* ===================== CALC TABLE 4 ===================== */






function recalcTable4(){

  let pos = 0, avg = 0, neg = 0;

  const ignorePlanetProgs = document.getElementById("ignorePlanetProgs").checked;
  const ignoreCuspProgs   = document.getElementById("ignoreCuspProgs").checked;
  const ignoreCusps       = document.getElementById("ignoreCusps").checked;

  entities.forEach(e=>{

    const inRow  = [...tbody.children].find(r=>r.dataset?.entity===e);
    const outRow = [...tatvaBody.children].find(r=>r.dataset?.entity===e);

    if(!inRow || !outRow) return;

    /* ===== RESET VISIBILITY FIRST ===== */
    outRow.style.display = "";

    /* ===== APPLY IGNORE RULES (TABLE 4 ONLY) ===== */
    if(
      (ignorePlanetProgs && isPlanetProg(e)) ||
      (ignoreCuspProgs   && isCuspProg(e))   ||
      (ignoreCusps       && isCusp(e))
    ){
      outRow.style.display = "none";
      return;
    }

    const b = inRow.children[1].querySelector("select").value;
    const g = inRow.children[2].querySelector("select").value;

    if(b==="" || g===""){
      outRow.querySelector(".bt").innerText="";
      outRow.querySelector(".gt").innerText="";
      outRow.querySelector(".res").innerText="";
      outRow.querySelector(".res").style.color="";
      return;
    }

    const bRasi = Math.floor(Number(b)/9);
    const gRasi = Math.floor(Number(g)/9);

    const bt = tatvaMap[bRasi];
    const gt = tatvaMap[gRasi];

    const v = tatvaVerdict(bt,gt);

    if(v.text==="Good") pos++;
    if(v.text==="Average") avg++;
    if(v.text==="Bad") neg++;

    outRow.querySelector(".bt").innerText = bt;
    outRow.querySelector(".gt").innerText = gt;
    outRow.querySelector(".res").innerText = v.text;
    outRow.querySelector(".res").style.color = v.color;
  });

  document.getElementById("t4pos").innerText = `Positive : ${pos}`;
  document.getElementById("t4avg").innerText = `Average : ${avg}`;
  document.getElementById("t4neg").innerText = `Negative : ${neg}`;
}




</script>
















<!-- ================= TABLE 5 : TARA BALA + NAKSHATRA COUNT ================= -->

<div class="panel">
<h2>Table 5 ‚Äì Tara Bala & Nakshatra Count</h2>

<table id="taraTable">
<thead>
<tr>
  <th>Entity</th>
  <th>Boy ‚Üí Girl<br><small>Tara / Count</small></th>
  <th>Girl ‚Üí Boy<br><small>Tara / Count</small></th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>












<script>
/* ===================== TARA + NAKSHATRA COUNT ===================== */

const TARA_NAMES = [
  "Janma",
  "Sampath",
  "Vipath",
  "Kshema",
  "Pratyari",
  "Sadhana",
  "Nidana",
  "Mithra",
  "Athi-Mithra"
];

const taraOrder = [
  "Lagna",
  "_gap_",
  "Chandra",
  "Venus",
  "Mangala",
  "Guru",
  "_gap_",
  "Budha",
  "Shani",
  "_gap_",
  "Surya",
  "Rahu",
  "Ketu",
  "_gap_",
  "Lagn Progs",
  "Chandra Progs",
  "ALP Progs"
];


const taraBody = document.querySelector("#taraTable tbody");

/* ===== BUILD TABLE ===== */

taraOrder.forEach(e=>{
  if(e === "_gap_"){
    taraBody.insertAdjacentHTML("beforeend",`
      <tr class="gap-row">
        <td colspan="3"></td>
      </tr>
    `);
    return;
  }

  taraBody.insertAdjacentHTML("beforeend",`
    <tr data-entity="${e}">
      <td><b>${e}</b></td>
      <td class="bg"></td>
      <td class="gb"></td>
    </tr>
  `);
});

/* ===== CORE FUNCTIONS ===== */

// Nakshatra index (0‚Äì26)
function getNakIndex(padaIndex){
  return Math.floor(Number(padaIndex) / 4);
}

// Tara name
function getTaraName(fromNak, toNak){
  const diff = (toNak - fromNak + 27) % 27;
  return TARA_NAMES[diff % 9];
}

// Nakshatra count (1‚Äì27, inclusive)
function getNakCount(fromNak, toNak){
  return (toNak - fromNak + 27) % 27 + 1;
}

/* ===== RECALC TABLE 5 ===== */

function recalcTable5(){

  taraOrder.forEach(e=>{
    if(e === "_gap_") return;

    const inRow  = [...tbody.children].find(r=>r.dataset?.entity===e);
    const outRow = [...taraBody.children].find(r=>r.dataset?.entity===e);

    if(!inRow || !outRow) return;

    const b = inRow.children[1].querySelector("select").value;
    const g = inRow.children[2].querySelector("select").value;

    if(b==="" || g===""){
      outRow.querySelector(".bg").innerText = "";
      outRow.querySelector(".gb").innerText = "";
      return;
    }

    const bNak = getNakIndex(b);
    const gNak = getNakIndex(g);

    /* === Boy ‚Üí Girl === */
    const bgTara  = getTaraName(bNak, gNak);
    const bgCount = getNakCount(bNak, gNak);
    outRow.querySelector(".bg").innerText = `${bgTara} (${bgCount})`;

    /* === Girl ‚Üí Boy === */
    const gbTara  = getTaraName(gNak, bNak);
    const gbCount = getNakCount(gNak, bNak);
    outRow.querySelector(".gb").innerText = `${gbTara} (${gbCount})`;
  });
}











updateTable1HideOnly();
updateTable1HideOnly();

/* ===================== MASTER GLOBAL HOOK ===================== */

document.addEventListener("change",e=>{
  if(IS_SWISS_LOADING) return;

  if(e.target.matches("select,input")){
    recalcTable2();
    recalcTable3();
    recalcTable4();
    recalcTable5();
  }
});








</script>








<!-- ================= TABLE 6 : 36 GUNA (ASHTA-KOOTA) MATRIX ================= -->

<div class="panel">
<h2>Table 6 ‚Äì 36 Guna (Ashta-Koota) Matching</h2>

<div style="margin-bottom:8px;font-weight:900">
  <label style="margin-right:16px">
    <input type="checkbox" id="hideCuspsT6">
    Hide Cusps
  </label>

  <label>
    <input type="checkbox" id="hideCuspProgsT6" checked>
    Hide Cusp Progs
  </label>
  
  
  
  <label style="margin-left:16px">
  <input type="checkbox" id="hidePlanetProgsT6" checked>
  Hide Planet Progs
</label>

  
  
</div>






<table id="guna36Table">
<thead>
<tr>
  <th rowspan="2">Graha</th>
  <th colspan="8">Ashta-Koota Breakdown</th>
  <th rowspan="2">Total<br>/ 36</th>
</tr>
<tr>
  <th>Varna<br>(1)</th>
  <th>Vashya<br>(2)</th>
  <th>Tara<br>(3)</th>
  <th>Yoni<br>(4)</th>
  <th>Graha Maitri<br>(5)</th>
  <th>Gana<br>(6)</th>
  <th>Bhakoot<br>(7)</th>
  <th>Nadi<br>(8)</th>
</tr>
</thead>

<tbody>



<!-- ===== DOUBLE GAP BEFORE PROGRESSIONS ===== -->
<tr class="gap-row"><td colspan="10"></td></tr>
<tr class="gap-row"><td colspan="10"></td></tr>


<tr class="guna-lagna" data-entity="Lagna">
  <td><b>‚≠ê Lagna</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Chandra">
  <td><b>Chandra</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>




<!-- ===== DOUBLE GAP BEFORE PROGRESSIONS ===== -->
<tr class="gap-row"><td colspan="10"></td></tr>
<tr class="gap-row"><td colspan="10"></td></tr>




<tr data-entity="Venus">
  <td><b>Venus</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Mangala">
  <td><b>Mangala</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Guru">
  <td><b>Guru</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Budha">
  <td><b>Budha</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>


<!-- ===== DOUBLE GAP BEFORE PROGRESSIONS ===== -->
<tr class="gap-row"><td colspan="10"></td></tr>
<tr class="gap-row"><td colspan="10"></td></tr>


<tr data-entity="Shani">
  <td><b>Shani</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Surya">
  <td><b>Surya</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Rahu">
  <td><b>Rahu</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Ketu">
  <td><b>Ketu</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>
	
	
	
	
	
	
	
	
	<!-- ===== DOUBLE GAP BEFORE PROGRESSIONS ===== -->
<tr class="gap-row"><td colspan="10"></td></tr>
<tr class="gap-row"><td colspan="10"></td></tr>
	
	
<!-- ===== PROGRESSION GUNA MATCHING ===== -->

<tr data-entity="Lagn Progs">
  <td><b>Lagn Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Chandra Progs">
  <td><b>Chandra Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>


<!-- ===== DOUBLE GAP BEFORE PROGRESSIONS ===== -->
<tr class="gap-row"><td colspan="10"></td></tr>
<tr class="gap-row"><td colspan="10"></td></tr>



<tr data-entity="Venus Progs">
  <td><b>Venus Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Mangala Progs">
  <td><b>Mangala Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Guru Progs">
  <td><b>Guru Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Budha Progs">
  <td><b>Budha Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Shani Progs">
  <td><b>Shani Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Surya Progs">
  <td><b>Surya Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Rahu Progs">
  <td><b>Rahu Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Ketu Progs">
  <td><b>Ketu Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>











<!-- ===== DOUBLE GAP BEFORE PROGRESSIONS ===== -->
<tr class="gap-row"><td colspan="10"></td></tr>
<tr class="gap-row"><td colspan="10"></td></tr>


<tr data-entity="Cusp 1">
  <td><b>Cusp 1</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

	
<tr data-entity="Cusp 2">

  <td><b>Cusp 2</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp3">
  <td><b>Cusp 3</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp4">
  <td><b>Cusp 4</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp5">
  <td><b>Cusp 5</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp6">
  <td><b>Cusp 6</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp7">
  <td><b>Cusp 7</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp8">
  <td><b>Cusp 8</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp9">
  <td><b>Cusp 9</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp10">
  <td><b>Cusp 10</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp11">
  <td><b>Cusp 11</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>

<tr data-entity="Cusp12">
  <td><b>Cusp 12</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>





<!-- ===== DOUBLE GAP BEFORE CUSP PROGRESSIONS ===== -->
<tr class="gap-row"><td colspan="10"></td></tr>
<tr class="gap-row"><td colspan="10"></td></tr>


<tr data-entity="Cusp1 Progs">
  <td><b>Cusp 1 Progs</b></td>
  <td class="varna"></td>
  <td class="vashya"></td>
  <td class="tara"></td>
  <td class="yoni"></td>
  <td class="grahaMaitri"></td>
  <td class="gana"></td>
  <td class="bhakoot"></td>
  <td class="nadi"></td>
  <td class="total"></td>
</tr>







<tr data-entity="Cusp2 Progs">
  <td><b>Cusp 2 Progs</b></td>
  <td class="varna"></td><td class="vashya"></td><td class="tara"></td>
  <td class="yoni"></td><td class="grahaMaitri"></td>
  <td class="gana"></td><td class="bhakoot"></td>
  <td class="nadi"></td><td class="total"></td>
</tr>

<tr data-entity="Cusp3 Progs"><td><b>Cusp 3 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp4 Progs"><td><b>Cusp 4 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp5 Progs"><td><b>Cusp 5 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp6 Progs"><td><b>Cusp 6 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp7 Progs"><td><b>Cusp 7 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp8 Progs"><td><b>Cusp 8 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp9 Progs"><td><b>Cusp 9 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp10 Progs"><td><b>Cusp 10 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp11 Progs"><td><b>Cusp 11 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>

<tr data-entity="Cusp12 Progs"><td><b>Cusp 12 Progs</b></td><td class="varna"></td><td class="vashya"></td><td class="tara"></td><td class="yoni"></td><td class="grahaMaitri"></td><td class="gana"></td><td class="bhakoot"></td><td class="nadi"></td><td class="total"></td></tr>















</tbody>
</table>
</div>












<script>
/* ===================== TABLE 6 : 36 GUNA ENGINE (FULL REPLACEMENT) ===================== */

/* ===== VARNA ===== */
const VARNA_MAP = {
  0:"Kshatriya",1:"Vaishya",2:"Shudra",3:"Brahmin",
  4:"Kshatriya",5:"Vaishya",6:"Shudra",7:"Brahmin",
  8:"Kshatriya",9:"Vaishya",10:"Shudra",11:"Brahmin"
};
const VARNA_ORDER = ["Shudra","Vaishya","Kshatriya","Brahmin"];

/* ===== VASHYA ===== */
const VASHYA_MAP = {
  Aries:["Leo","Scorpio"],
  Taurus:["Cancer","Libra"],
  Gemini:["Virgo"],
  Cancer:["Scorpio","Sagittarius"],
  Leo:["Libra"],
  Virgo:["Pisces","Gemini"],
  Libra:["Virgo","Capricorn"],
  Scorpio:["Cancer"],
  Sagittarius:["Pisces"],
  Capricorn:["Aries","Aquarius"],
  Aquarius:["Aries"],
  Pisces:["Capricorn"]
};

const RASI_LIST = [
  "Aries","Taurus","Gemini","Cancer","Leo","Virgo",
  "Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"
];




/* ===================== VASHYA GROUPS (ASHTA-KOOTA) ===================== */

const VASHYA_GROUP = {
  Aries: "Chatushpada",
  Taurus: "Chatushpada",
  Gemini: "Dwipada",
  Cancer: "Jalachara",
  Leo: "Vanachara",
  Virgo: "Dwipada",
  Libra: "Dwipada",
  Scorpio: "Keeta",
  Sagittarius: "Dwipada",
  Capricorn: "Jalachara",
  Aquarius: "Dwipada",
  Pisces: "Jalachara"
};

const VASHYA_MATRIX = {
  Chatushpada: { Chatushpada:2, Jalachara:0, Vanachara:2, Keeta:0, Dwipada:0 },
  Jalachara:   { Chatushpada:1, Jalachara:2, Vanachara:0, Keeta:1, Dwipada:1 },
  Vanachara:   { Chatushpada:1, Jalachara:0, Vanachara:2, Keeta:0, Dwipada:0 },
  Keeta:       { Chatushpada:0, Jalachara:1, Vanachara:0, Keeta:2, Dwipada:1 },
  Dwipada:     { Chatushpada:1, Jalachara:1, Vanachara:1, Keeta:0, Dwipada:2 }
};



/* ===== GANA ===== */
const GANA_MAP = [
  "Deva","Manushya","Rakshasa","Manushya","Deva","Manushya","Deva","Deva","Rakshasa",
  "Rakshasa","Manushya","Deva","Deva","Rakshasa","Deva","Rakshasa","Deva","Rakshasa",
  "Rakshasa","Manushya","Deva","Deva","Rakshasa","Rakshasa",
  "Manushya","Manushya","Deva"
];





/* ===== NADI (LOCKED TO REFERENCE APP) ===== */
const NADI_MAP = [
  "Aadi",    // Ashwini
  "Madhya",  // Bharani
  "Antya",   // Krittika
  "Madhya",  // Rohini
  "Aadi",    // Mrigashira
  "Antya",   // Ardra
  "Aadi",    // Punarvasu
  "Madhya",  // Pushya
  "Antya",   // Ashlesha

  "Aadi",    // Magha
  "Madhya",  // Purva Phalguni
  "Antya",   // Uttara Phalguni
  "Aadi",    // Hasta ‚úÖ
  "Madhya",  // Chitra
  "Antya",   // Swati
  "Antya",   // Vishakha ‚úÖ
  "Madhya",  // Anuradha
  "Antya",   // Jyeshtha

  "Aadi",    // Moola
  "Madhya",  // Purva Ashadha
  "Antya",   // Uttara Ashadha
  "Aadi",    // Shravana
  "Madhya",  // Dhanishta
  "Aadi",    // Shatabhisha
  "Antya",   // Purva Bhadrapada
  "Madhya",  // Uttara Bhadrapada
  "Aadi"     // Revati
];



/* ===== YONI ===== */
const YONI_MAP = [
  "Horse","Elephant","Sheep","Serpent","Deer","Dog","Cat","Sheep","Cat",
  "Rat","Rat","Cow","Buffalo","Tiger","Buffalo","Tiger","Deer","Dog",
  "Dog","Monkey","Mongoose","Monkey","Lion","Horse",
  "Lion","Cow","Elephant"
];

/* ===== GRAHA RELATION ===== */
const GRAHA_REL = {
  Surya:{friend:["Chandra","Mangala","Guru"],enemy:["Shani","Venus"],neutral:["Budha"]},
  Chandra:{friend:["Surya","Budha"],enemy:[],neutral:["Mangala","Guru","Venus","Shani"]},
  Mangala:{friend:["Surya","Chandra","Guru"],enemy:["Budha"],neutral:["Venus","Shani"]},
  
  Guru:{friend:["Surya","Chandra","Mangala"],enemy:["Budha","Venus"],neutral:["Shani"]},
  Venus:{friend:["Budha","Shani"],enemy:["Surya","Chandra"],neutral:["Mangala","Guru"]},
  Budha:{
  friend:["Surya","Venus","Shani"],
  enemy:["Chandra"],
  neutral:["Mangala","Guru"]
},
Shani:{
  friend:["Budha","Venus"],
  enemy:["Surya","Chandra"],
  neutral:["Mangala","Guru"]
},

  
  Rahu:{friend:[],enemy:[],neutral:[]},
  Ketu:{friend:[],enemy:[],neutral:[]}
};

/* ===== HELPERS ===== */
function getNakIndex36(p){ return Math.floor(p/4); }
function getRasiIndex36(p){ return Math.floor(p/9); }




/* ===================== MATCHING DIRECTION ===================== */
/*
Ashta-Koota standard:
ALL counts are done from FEMALE ‚Üí MALE
Girl is the reference, Boy is the target
*/
function getMatchNakIndices(boyPada, girlPada){
  return {
    fromNak: Math.floor(girlPada / 4), // FEMALE
    toNak:   Math.floor(boyPada  / 4)  // MALE
  };
}

function getMatchRasiIndices(boyPada, girlPada){
  return {
    fromRasi: Math.floor(girlPada / 9), // FEMALE
    toRasi:   Math.floor(boyPada  / 9)  // MALE
  };
}












function calc36Guna(boyPada, girlPada){

  const bn = Math.floor(boyPada / 4);
  const gn = Math.floor(girlPada / 4);
  const br = Math.floor(boyPada / 9);
  const gr = Math.floor(girlPada / 9);








/* ================= VARNA (1) ================= */
/*
Ashta-Koota Varna (CLASSICAL ‚Äì LOCKED)

Rule:
Bride Varna must be
EQUAL TO or LOWER THAN
Groom Varna ‚Üí PASS (1)
Else ‚Üí FAIL (0)

Hierarchy:
Shudra < Vaishya < Kshatriya < Brahmin
*/

let varna = 0;

// Bride & Groom rasi indices already exist
const brideVarna = VARNA_MAP[gr]; // girl rasi
const groomVarna = VARNA_MAP[br]; // boy rasi

const brideRank = VARNA_ORDER.indexOf(brideVarna);
const groomRank = VARNA_ORDER.indexOf(groomVarna);

if (brideRank <= groomRank) {
  varna = 1;
} else {
  varna = 0;
}




  /* ================= VASHYA (2) ================= */
  // STRICT ASHTA-KOOTA VASHYA
  // Bride ‚Üí Groom
  // RƒÅ≈õi based ONLY

  let vashya = 0;

  const VASHYA_GROUP_EXACT = {
    Aries: "Chatushpada",
    Taurus: "Chatushpada",

    Gemini: "Dwipada",
    Virgo: "Dwipada",
    Libra: "Dwipada",
    Sagittarius: "Dwipada",
    Aquarius: "Dwipada",

    Cancer: "Jalachara",
    Pisces: "Jalachara",
    Capricorn: "Jalachara",

    Leo: "Vanachara",
    Scorpio: "Keeta"
  };

  const VASHYA_MATRIX_EXACT = {
    Chatushpada: { Chatushpada:2, Jalachara:0, Vanachara:2, Keeta:0, Dwipada:0 },
    Jalachara:   { Chatushpada:1, Jalachara:2, Vanachara:0, Keeta:1, Dwipada:1 },
    Vanachara:   { Chatushpada:1, Jalachara:0, Vanachara:2, Keeta:0, Dwipada:0 },
    Keeta:       { Chatushpada:0, Jalachara:1, Vanachara:0, Keeta:2, Dwipada:1 },
    Dwipada:     { Chatushpada:1, Jalachara:1, Vanachara:1, Keeta:0, Dwipada:2 }
  };

  const brideRasi = RASI_LIST[gr];
  const groomRasi = RASI_LIST[br];

  const brideGroup = VASHYA_GROUP_EXACT[brideRasi];
  const groomGroup = VASHYA_GROUP_EXACT[groomRasi];

  if (brideGroup && groomGroup) {
    vashya = VASHYA_MATRIX_EXACT[brideGroup][groomGroup] ?? 0;
  }














/* ================= TARA / DINA (3) ================= */
// FEMALE ‚Üí MALE ONLY (LOCKED BY SCREENSHOTS)

const fromNak = Math.floor(girlPada / 4);
const toNak   = Math.floor(boyPada  / 4);

const count = (toNak - fromNak + 27) % 27 + 1;
const taraNo = count % 9;

let tara = 0;

// Janma(1), Vipath(3), Pratyari(5), Nidana(7) ‚Üí 0
if ([1,3,5,7].includes(taraNo)) {
  tara = 0;
} 
// Sampath(2), Kshema(4), Sadhana(6), Mithra(8), Ati-Mithra(0) ‚Üí 3
else {
  tara = 3;
}












  /* ================= YONI (4) ================= */
  let yoni = 0;

  const yBoy = YONI_MAP[bn];
  const yGirl = YONI_MAP[gn];

  // Same Yoni
  if (yBoy === yGirl) {
    yoni = 4;
  }
  else {

    // Extreme enemy pairs ‚Üí 0
    const extremeEnemies = [
      ["Horse","Elephant"],
      ["Cat","Rat"],
      ["Dog","Deer"],
      ["Serpent","Mongoose"],
      ["Lion","Elephant"]
    ];

    // Mild enemy pairs ‚Üí 1
    const mildEnemies = [
      ["Tiger","Buffalo"],
      ["Monkey","Mongoose"],
      ["Lion","Dog"]
    ];

    const isExtreme = extremeEnemies.some(
      p => (p[0]===yBoy && p[1]===yGirl) || (p[0]===yGirl && p[1]===yBoy)
    );

    const isMild = mildEnemies.some(
      p => (p[0]===yBoy && p[1]===yGirl) || (p[0]===yGirl && p[1]===yBoy)
    );

    if (isExtreme) {
      yoni = 0;
    }
    else if (isMild) {
      yoni = 1;
    }
    else {
      yoni = 2;
    }
  }

  
  
  
  
  
  
  
  
  

  /* ================= GRAHA MAITRI (5) ================= */
  const normalize = l => (
    l === "Jupiter" ? "Guru" :
    l === "Saturn"  ? "Shani" :
    l
  );

  // Graha Maitri MUST use RASI LORDS (not Nakshatra lords)
		const RASI_LORDS = [
		  "Mangala", // Aries
		  "Venus",   // Taurus
		  "Budha",   // Gemini
		  "Chandra", // Cancer
		  "Surya",   // Leo
		  "Budha",   // Virgo
		  "Venus",   // Libra
		  "Mangala", // Scorpio
		  "Guru",    // Sagittarius
		  "Shani",   // Capricorn
		  "Shani",   // Aquarius
		  "Guru"     // Pisces
		];

		const bl = RASI_LORDS[br];
		const gl = RASI_LORDS[gr];
		let grahaMaitri = 0;



		/* ===== SAME RASI LORD OVERRIDE ===== */
		if (bl === gl) {
		  grahaMaitri = 5;
		}
		else {


	/* ===== OVERRIDE GRAHA MAITRI (ASHTA-KOOTA CORRECT LADDER) ===== */

const relBG = {
  f: GRAHA_REL[bl]?.friend.includes(gl),
  n: GRAHA_REL[bl]?.neutral.includes(gl),
  e: GRAHA_REL[bl]?.enemy.includes(gl)
};

const relGB = {
  f: GRAHA_REL[gl]?.friend.includes(bl),
  n: GRAHA_REL[gl]?.neutral.includes(bl),
  e: GRAHA_REL[gl]?.enemy.includes(bl)
};

// Same lord already handled above (5)

if (relBG.f && relGB.f) {
  grahaMaitri = 5;
}
else if (
  (relBG.f && relGB.n) ||
  (relBG.n && relGB.f)
) {
  grahaMaitri = 4;
}
else if (relBG.n && relGB.n) {
  grahaMaitri = 3;
}
else if (
  (relBG.f && relGB.e) ||
  (relBG.e && relGB.f)
) {
  grahaMaitri = 2;
}
else if (
  (relBG.n && relGB.e) ||
  (relBG.e && relGB.n)
) {
  grahaMaitri = 1;
}
else {
  grahaMaitri = 0;
}
}





	
	
	
	
	
	
  /* ================= GANA (6) ================= */
  // STRICT ASHTA-KOOTA GANA
  // Bride ‚Üí Groom

  let gana = 0;

  const brideGana = GANA_MAP[gn];
  const groomGana = GANA_MAP[bn];

  const GANA_MATRIX_EXACT = {
    Deva: {
      Deva: 6,
      Manushya: 5,
      Rakshasa: 1
    },
    Manushya: {
      Deva: 5,
      Manushya: 6,
      Rakshasa: 0
    },
    Rakshasa: {
      Deva: 1,
      Manushya: 0,
      Rakshasa: 6
    }
  };

  if (brideGana && groomGana) {
    gana = GANA_MATRIX_EXACT[brideGana][groomGana] ?? 0;
  }










/* ================= BHAKOOT (7) ‚Äì RELAXED (SAFE) ================= */

// Default bhakoot
let bhakoot = 0;

// Rasi distance (Bride ‚Üí Groom)
const rasiDist = (br - gr + 12) % 12;

// Auspicious distances ‚Üí always good
if ([0, 2, 4, 6, 8, 10].includes(rasiDist)) {
  bhakoot = 7;
}
else {
  /*
    Dosha distances: 2-12, 5-9, 6-8
    Relax rule:
    If Graha Maitri is FRIENDLY (4 or 5),
    then IGNORE Bhakoot dosha
  */

  if (grahaMaitri >= 4) {
    bhakoot = 7;   // Dosha cancelled
  } else {
    bhakoot = 0;   // Dosha applies
  }
}













  /* ================= NADI (8) ================= */
  // LOCKED TO REFERENCE APP
  // Nakshatra based ONLY
  // SAME Nadi ‚Üí 0
  // DIFFERENT Nadi ‚Üí 8

  let nadi = 0;

  // Explicit nakshatra indices (NO reuse)
  const girlNak = Math.floor(girlPada / 4);
  const boyNak  = Math.floor(boyPada  / 4);

  const girlNadi = NADI_MAP[girlNak];
  const boyNadi  = NADI_MAP[boyNak];

  if (girlNadi !== boyNadi) {
    nadi = 8;
  } else {
    nadi = 0;
  }










  const total =
varna + vashya + tara + yoni +
grahaMaitri + gana + bhakoot + nadi;



  return {
    varna,
    vashya,
    tara,
    yoni,
    grahaMaitri,
    gana,
    bhakoot,
    nadi,
    total
  };
}




















/* ===== FILL TABLE ===== */
function recalcTable6(){
  document.querySelectorAll("#guna36Table tbody tr").forEach(tr=>{
    const ent=tr.dataset.entity;
    if(!ent) return;
   
   
   
	   let boyPada, girlPada;

	if(ent.startsWith("Cusp")){
	  const n = Number(ent.match(/\d+/)[0]);
	  const isProg = ent.includes("Progs");

	  const key = isProg ? n + "P" : n;

	  boyPada  = CUSP_PADAS.boy[key];
	  girlPada = CUSP_PADAS.girl[key];
	}
else{
	  const inRow=tbody.querySelector(`tr[data-entity="${ent}"]`);
	  if(!inRow) return;
	  boyPada  = inRow.children[1].querySelector("select").value;
	  girlPada = inRow.children[2].querySelector("select").value;
	}

   
   
   
   
   
	
    

    if(boyPada==null || girlPada==null || boyPada==="" || girlPada===""){
      tr.querySelectorAll("td:not(:first-child)").forEach(td=>td.innerText="");
      return;
    }

    const r = calc36Guna(+boyPada, +girlPada);
	
	



	
	
    tr.querySelector(".varna").innerText=r.varna;
    tr.querySelector(".vashya").innerText=r.vashya;
    tr.querySelector(".tara").innerText=r.tara;
    tr.querySelector(".yoni").innerText=r.yoni;
    tr.querySelector(".grahaMaitri").innerText=r.grahaMaitri;
    tr.querySelector(".gana").innerText=r.gana;
    tr.querySelector(".bhakoot").innerText=r.bhakoot;
    tr.querySelector(".nadi").innerText=r.nadi;
	
	
		// SHOW NUMERIC TOTAL FOR LAGNA (DEBUG / COMPARATIVE MODE)
tr.querySelector(".total").innerText = `${r.total} / 36`;

		
		
  });
}
</script>








<script>



/* ===================== TABLE 6 HIDE / SHOW ENGINE ===================== */

function updateTable6Visibility(){

  const hideCusps =
    document.getElementById("hideCuspsT6")?.checked;

  const hideCuspProgs =
    document.getElementById("hideCuspProgsT6")?.checked;

  const hidePlanetProgs =
    document.getElementById("hidePlanetProgsT6")?.checked;

  document
    .querySelectorAll("#guna36Table tbody tr[data-entity]")
    .forEach(tr=>{

      const e = tr.dataset.entity;
      tr.style.display = "";

      // Natal cusps
      if(hideCusps && /^Cusp\s*\d+$/.test(e)){
        tr.style.display = "none";
      }

      // Cusp progressions
      if(hideCuspProgs && /^Cusp\s*\d+\s+Progs$/.test(e)){
        tr.style.display = "none";
      }

      // Planet progressions ONLY
      if(
        hidePlanetProgs &&
        e.endsWith("Progs") &&
        !e.startsWith("Lagn") &&
        !e.startsWith("Chandra") &&
        !e.startsWith("Cusp")
      ){
        tr.style.display = "none";
      }
    });
}






/* ===================== FINAL GLOBAL HOOK (TABLE 6 SAFE) ===================== */

document.addEventListener("change", e=>{
  if(IS_SWISS_LOADING) return;
  if(e.target.matches("select,input")){
    recalcTable6();
  }
});







["hideCuspsT6","hideCuspProgsT6"].forEach(id=>{
  document.getElementById(id).addEventListener("change",()=>{
    updateTable6Visibility();
  });
});


["hidePlanetProgsT6"].forEach(id=>{
  document.getElementById(id).addEventListener("change",()=>{
    updateTable6Visibility();
  });
});



// Apply once on load
updateTable6Visibility();



</script>












<script>
/* ===================== UNIVERSAL SWISS JSON SUPPORT ===================== */

let IS_SWISS_LOADING = false;


// Store cusp padas (2‚Äì12)
const CUSP_PADAS = {
  boy: {},
  girl: {}
};



/* DEGREE ‚Üí PADA (0‚Äì107) */
function degreeToPada(deg){
  deg = ((deg % 360) + 360) % 360;

  const PADA_SPAN = 360 / 108;
  const EPS = 1e-6;   // üî• important for fast Vimshottari progress

  return Math.floor((deg + EPS) / PADA_SPAN);
}



/* ===================== PROGRESSION ENGINES ===================== */

// Years lived from DOB (UTC safe)
function yearsSince(dobUtc){
  const dobMs = Date.parse(dobUtc);      // UTC
  const nowMs = Date.now();              // UTC
  return (nowMs - dobMs) / (365.2422 * 24 * 60 * 60 * 1000);
}

/* ===== ALP PROGRESSION (ABSOLUTE) ===== */
/* ===== ALP (ABSOLUTE LAGNA PROGRESSION) ===== */
/*
Rule:
- Natal Lagna = 0 reference
- 1 year = 3¬∞
- 10 years = 30¬∞
*/

function calcALPDegree(natalLagnaDeg, dobUtc){
  return (natalLagnaDeg + yearsSince(dobUtc) * 3) % 360;
}

/* ===== VIMSHOTTARI STAR-LORD PROGRESSION ===== */
const DASA_YEARS = {
  Ketu:7, Venus:20, Surya:6, Chandra:10,
  Mangala:7, Rahu:18, Jupiter:16, Saturn:19, Budha:17
};










/* ===== TRUE VIMSHOTTARI PROGRESSION (NAKSHATRA BASED) ===== */
/*
Progress stays INSIDE the natal Nakshatra (13¬∞20‚Ä≤)
*/

/* ===== TRUE VIMSHOTTARI PROGRESSION (WITH MAHADASHA SHIFT) ===== */

const VIM_ORDER = [
  "Ketu","Venus","Surya","Chandra",
  "Mangala","Rahu","Jupiter","Saturn","Budha"
];

const NAK_SPAN = 360 / 27; // 13.333333¬∞

/* ===== TRUE VIMSHOTTARI PROGRESSION (STANDARD MOON METHOD) ===== */
/*
Used for:
- Vimshottari Moon Progress
- Vimshottari Lagna Progress

Rule:
- Speed is fixed by BIRTH nakshatra lord
- Progress is CONTINUOUS
- Nakshatra changes naturally by degree crossing
*/

function calcVimshottariProgress(natalDeg, dobUtc){

  const NAK_SPAN = 360 / 27; // 13¬∞20'
  const livedYears = yearsSince(dobUtc);

  // Birth nakshatra
  const birthNak = Math.floor(natalDeg / NAK_SPAN);
  const nakStart = birthNak * NAK_SPAN;
  const offsetInNak = natalDeg - nakStart;

  const lord = nakLords[birthNak];
  const dashaYears = DASA_YEARS[lord];

  // üî• CRITICAL FIX: Mahadasha balance at birth
  const balanceAtBirth =
    ((NAK_SPAN - offsetInNak) / NAK_SPAN) * dashaYears;

  let yearsLeft = livedYears - balanceAtBirth;

  // Still inside birth Mahadasha
  if (yearsLeft <= 0) {
    const progressedOffset =
      offsetInNak + (livedYears / dashaYears) * NAK_SPAN;
    return nakStart + progressedOffset;
  }

  // Move nakshatra by nakshatra
  let curNak = birthNak;

  while (true) {
    curNak = (curNak + 1) % 27;
    const curLord = nakLords[curNak];
    const spanYears = DASA_YEARS[curLord];

    if (yearsLeft <= spanYears) {
      const progOffset =
        (yearsLeft / spanYears) * NAK_SPAN;
      return curNak * NAK_SPAN + progOffset;
    }

    yearsLeft -= spanYears;
  }
}












/* APPLY JSON TO COLUMN */
function applySwissJson(json, columnIndex){
  IS_SWISS_LOADING = true;
  
  
  const dobUtc = json.meta?.datetime_utc;
  
  const sys = getSystem();
  const ay = json.ayanamshas?.Lahiri || json.ayanamshas?.["KP New"];
  if(!ay) return alert("Unsupported JSON: No Lahiri/KP data");

  const planetMap = ay.planets;
  
  
  
  
  
  

// ===== HOUSE CUSPS (Swiss Ephemeris) =====
const cusps = ay.houses?.cusps || ay.cusps;
if(cusps){
  for(let i=1;i<=12;i++){
    const deg = (i === 1)
      ? ay.lagna              // üî• Cusp1 = Lagna
      : cusps[i];

    if(typeof deg !== "number") continue;

    const side = columnIndex === 1 ? "boy" : "girl";

    // 1Ô∏è‚É£ Natal cusp
    CUSP_PADAS[side][i] = degreeToPada(deg);

    // üëâ expose natal cusp to Table 1
    const natalRow = [...tbody.children]
  .find(r => r.dataset?.entity === `Cusp ${i}`);


    if(natalRow){
      natalRow.children[columnIndex]
        .querySelector("select").value = CUSP_PADAS[side][i];
    }

    // 2Ô∏è‚É£ Progressed cusp (Vimshottari)
    if(dobUtc && i >= 2){
      const progDeg = calcVimshottariProgress(deg, dobUtc);
      CUSP_PADAS[side][i + "P"] = degreeToPada(progDeg);
    }
  }
}








// ===== EXPOSE CUSP PROGS TO TABLE 1 (DEBUG VIEW) =====
if(dobUtc){
  for(let i=2;i<=12;i++){
    const key = i + "P";
    const pada = CUSP_PADAS[columnIndex === 1 ? "boy" : "girl"][key];
    if(pada == null) continue;

    const row = [...tbody.children]
  .find(r => r.dataset?.entity === `Cusp ${i} Progs`);


    if(row){
      row.children[columnIndex]
         .querySelector("select").value = pada;
    }
  }
}




  
  
  
  const natalLagnaDeg = ay.lagna;
const natalMoonDeg  = planetMap.Chandra;


  const setVal = (entity, deg)=>{
    const row = [...tbody.children].find(r=>r.dataset?.entity===entity);
    if(!row) return;
    row.children[columnIndex].querySelector("select").value = degreeToPada(deg);
  };

  setVal("Lagna", natalLagnaDeg);

  setVal("Surya",   planetMap.Surya);
  setVal("Chandra", planetMap.Chandra);
  setVal("Mangala", planetMap.Mangala);
  setVal("Budha",   planetMap.Budha);
  setVal("Guru",    planetMap.Jupiter);
  setVal("Venus",   planetMap.Venus);
  setVal("Shani",   planetMap.Saturn);
  setVal("Rahu",    planetMap.Rahu_true ?? planetMap.Rahu);
  setVal("Ketu",    planetMap.Ketu_true ?? planetMap.Ketu);





  /* ===== PROGRESSIONS AUTO FILL ===== */

  
  if(dobUtc){

    // 1Ô∏è‚É£ LAGNA PROGS (Vimshottari Lagna ‚Äì Nakshatra based)
	const lagnaProgDeg = calcVimshottariProgress(natalLagnaDeg, dobUtc);
	setVal("Lagn Progs", lagnaProgDeg);


	// ===== CUSP 1 PROGS (SAME AS LAGNA PROGS) =====
	const side = columnIndex === 1 ? "boy" : "girl";
	CUSP_PADAS[side]["1P"] = degreeToPada(lagnaProgDeg);

	const cusp1ProgRow = [...tbody.children]
	  .find(r => r.dataset?.entity === "Cusp 1 Progs");

	if(cusp1ProgRow){
	  cusp1ProgRow.children[columnIndex]
		.querySelector("select").value = CUSP_PADAS[side]["1P"];
	}



	// 2Ô∏è‚É£ RASI PROGS (Vimshottari Moon ‚Äì Nakshatra based)
	const moonProgDeg = calcVimshottariProgress(natalMoonDeg, dobUtc);
	setVal("Chandra Progs", moonProgDeg);

	// 3Ô∏è‚É£ ALP PROGS (Absolute Lagna Progress)
	const alpDeg = calcALPDegree(natalLagnaDeg, dobUtc);
	setVal("ALP Progs", alpDeg);

	// 4Ô∏è‚É£ PLANET PROGS (Vimshottari ‚Äì same engine)

		// Venus
		setVal(
		  "Venus Progs",
		  calcVimshottariProgress(planetMap.Venus, dobUtc)
		);

		// Mangala
		setVal(
		  "Mangala Progs",
		  calcVimshottariProgress(planetMap.Mangala, dobUtc)
		);

		// Guru (Jupiter)
		setVal(
		  "Guru Progs",
		  calcVimshottariProgress(planetMap.Jupiter, dobUtc)
		);

		// Budha (Mercury)
		setVal(
		  "Budha Progs",
		  calcVimshottariProgress(planetMap.Budha, dobUtc)
		);

		// Shani (Saturn)
		setVal(
		  "Shani Progs",
		  calcVimshottariProgress(planetMap.Saturn, dobUtc)
		);

		// Surya
		setVal(
		  "Surya Progs",
		  calcVimshottariProgress(planetMap.Surya, dobUtc)
		);

		// Rahu
		setVal(
		  "Rahu Progs",
		  calcVimshottariProgress(
			planetMap.Rahu_true ?? planetMap.Rahu,
			dobUtc
		  )
		);

		// Ketu
		setVal(
		  "Ketu Progs",
		  calcVimshottariProgress(
			planetMap.Ketu_true ?? planetMap.Ketu,
			dobUtc
		  )
		);





  }







  recalcTable2();
  recalcTable3();
  recalcTable4();
  recalcTable5();
  recalcTable6();
  
  
    IS_SWISS_LOADING = false;

}

/* LOADERS */
function loadMaleSwiss(){
  const inp=document.getElementById("maleSwissInput");
  inp.value="";
  inp.click();
  inp.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>applySwissJson(JSON.parse(r.result),1);
    r.readAsText(e.target.files[0]);
  };
}

function loadFemaleSwiss(){
  const inp=document.getElementById("femaleSwissInput");
  inp.value="";
  inp.click();
  inp.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>applySwissJson(JSON.parse(r.result),2);
    r.readAsText(e.target.files[0]);
  };
}
</script>






</body>
</html>
